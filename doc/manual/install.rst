.. _install:

Installation Instructions
=========================

System Requirements
-------------------

.. warning::
   These instructions only apply if you **don't** intend to modify phc, and you
   are using a downloaded |phc| release. If you intend to modify it, or you are
   using the |phc| `SVN repository <http://code.google.com/p/phc>`_, please
   refer to the :ref:`instructions for developers <devintro>`.

|phc| needs a Unix-like environment to run (it has been tested on Linux,
Solaris, FreeBSD, Cygwin and Mac OS X).  To compile |phc|, you will need:

*  :program:`g++` *version 3.4.0* or higher
*  :program:`make`
*  :program:`Boost` *version 1.34* or higher
*  *PHP5 embed SAPI* (version 5.2.x recommended; refer to :ref:`phpbuild` for more details). This is
   required to compile PHP code with |phc|.
*  `Xerces-C++ <http://xerces.apache.org/xerces-c/>`_ if you
   want support for XML parsing (you don't need Xerces for XML unparsing).
*  *Boehm* garbage collector is used in |phc|, but not in code compiled by
   |phc|. If unavailable, it can be disabled with :option:`--disable-gc`, but |phc|
   will leak all memory it uses.


The following dependencies are optional:

*  a DOT viewer such as `graphviz <http://www.graphviz.org>`_
   if you want to be able to view the graphical output generated by |phc| (for
   example, syntax trees)

Under Debian/Ubuntu, the following command will install nearly all
dependencies:

.. sourcecode:: bash

   apt-get install build-essential libboost-all-dev libxerces27-dev graphviz libgc-dev


On Mac OS X, install XCode, which provides the necessary compilers.
For libraries, MacPorts can be used:

.. sourcecode:: bash

  port install boehmgc-devel boost xercesc
  export CPATH=/opt/local/include
  export LIBRARY_PATH=/opt/local/lib
   
You will still need to install the PHP embed SAPI manually.


.. _phpbuild:

PHP ``embed SAPI`` installation instructions
--------------------------------------------

If your operating system supplies a php5-embed package, or similar, you may :ref:`skip <install.instructions>` this section.

If you do not intend to compile PHP code using |phc|, you may 
:ref:`skip <install.instructions>` this section.

If you intend to hack on |phc|, you should look at :ref:`dev.phpbuild`.

In order to compile code, |phc| must have the PHP embed SAPI available, which
is typically not available via standard package managers. The embed SAPI is
also required for compiling stand-alone executables.

Download the PHP source (.tar.gz) package from `php.net <http://www.php.net>`_. We will assume you downloaded PHP
version 5.2.10, the latest version available at time of writing. To extract
PHP,

.. sourcecode:: bash

   tar zxvf php-5.2.10.tar.gz


This will create a new directory :file:`php-5.2.10`. In order to configure and
compile PHP, you must know what configuration options you require. These are
likely to be the same as the version of PHP you are currently using, which can
be examined using the following command [#configure_options]_

.. sourcecode:: bash

   php -i | grep Configure



We will assume these options are :option:`--enable-bcmath --with-gmp
--with-mysql`, a configuration which we occasionally use for benchmarking. You
are ready to build PHP. When configuring, you must add the :option:`--enable-embed`
option.

.. sourcecode:: bash

   CFLAGS="-O3" ./configure --enable-bcmath --with-gmp --with-mysql --enable-embed
   make


If this command does not succeed, there is a problem with PHP on your system,
and you should `file a bug report with the PHP group <http://bugs.php.net>`_ [#osx_bug]_.

The most important part of the command is :option:`--enable-embed`.  While the
:option:`CFLAGS="-O3"` environmental variable is optional, we find it speeds up
the executable by about four times. If PHP is already installed on your system,
you may want to install this version separately, using the :option:`--prefix`
option. Other configuration options are discussed in the :ref:`developer manual
<dev.phpbuild>`. Finally, install the embed SAPI:

.. sourcecode:: bash

   make install




.. _install.instructions:

Installation Instructions
-------------------------

First of all, you must `download <http://www.phpcompiler.org/downloads.html>`_ the latest
release of |phc|. To extract |phc|,

.. sourcecode:: bash

   tar zxvf phc-0.2.0.tar.gz

	
This will create a new directory ``phc-0.2.0`` that contains the
|phc| source tree. Finally, you must compile |phc|. If the dependencies are
in their standard locations, you should be able to simply type [#configure_help]_

.. sourcecode:: bash

   cd phc-0.2.0
   ./configure
   make

On Mac OS X, a bug prevents the use of libgc, so use:

.. sourcecode:: bash

   cd phc-0.2.0
   ./configure --disable-gc
   make

This should compile without any warnings or errors. If this step fails, please
send a bug report to the `mailing list
<http://www.phpcompiler.org/mailinglist.html>`_ with as much information about
your system as you can give, and we will try to resolve it. If you wish to test
your build of |phc|, please see :ref:`testing`.  Finally, install |phc| using

.. sourcecode:: bash

   make install


For information on running |phc|, see :ref:`runningphc`.  If you can follow
those instructions and you get the output you should get, congratulations!  You
have successfully installed |phc|.



Troubleshooting
---------------

Repository
##########

If building from |phc|'s subversion repository, it is important to run

.. sourcecode:: bash

   touch src/generated/*

before `make`.


Boost
#####

If `./configure` is not able to find your *Boost* libraries, try using a path like

.. sourcecode:: bash

   --with-boost=/opt/local

or

.. sourcecode:: bash

   --with-boost=/usr

Alternatively, users have had success with symlinking the boost libraries into a standard location, like `/usr/include/`.



.. [#osx_bug]
   
   There is a `known bug, and long work-around for OSX
   <http://bugs.php.net/bug.php?id=44462>`_ already filed in the PHP bug
   system.

.. [#configure_help]

   Consult :program:`./configure --help` for configuration options, if your
   dependencies are not in standard locations. 

.. [#configure_options]

   This line may not be present in some cases. If not, you may wish to find out
   how PHP is configured through some other means, such as looking up the
   source in your package manager. However, it is not necessary, and you may
   just assume there are no options. Alternatively, you may look through
   **./configure --help** to deterine the options for yourself.
