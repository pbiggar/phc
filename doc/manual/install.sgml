<chapter id="install">
<title id="install.title">Installation Instructions</title>

<section>
<title id="TODO">System Requirements</title>

<warning> 
<para>
	These instructions only apply if you <emphasis>don't</emphasis> intend to
	modify phc, and you are using a downloaded &phc release. If you intend to
	modify it, or you are using the &phc <ulink
	url="http://code.google.com/p/phc">SVN repository</ulink>, please refer to
	the <link linkend="devintro">instructions for developers</link>.
</para>
</warning>

<para>
	&phc needs a Unix-like environment to run (it has been tested on Linux,
	Solaris, FreeBSD, Cygwin and Mac OS X).  To compile &phc, you will need:

<itemizedlist>
	<listitem><para>
		<code>g++</code> <emphasis>version 3.4.0</emphasis> or higher
	</para></listitem>
	<listitem><para>
		<code>make</code>
	</para></listitem>
	<listitem><para>
		<code>Boost</code> <emphasis>version 1.34</emphasis> or higher
	</para></listitem>
	<listitem><para>
		<code>PHP5 embed SAPI</code> (version 5.2.x recommended; refer to <xref
		linkend="phpbuild" endterm="phpbuild.title"> for more details). This is
		required to compile PHP code with &phc;.
	</para></listitem>
	<listitem><para>
		<ulink url="http://xml.apache.org/xerces-c/">Xerces-C++</ulink> if you
		want support for XML parsing (you don't need Xerces for XML unparsing).
	</para></listitem>
	<listitem><para>
		<code>Boehm</code> garbage collector is used in &phc;, but not in code
		compiled by &phc;. If unavailable, it can be disabled with
		<code>--disable-gc</code>, but &phc; will leak all memory it uses.
	</para></listitem>

</itemizedlist>


<para>The following dependencies are optional:</para>

<itemizedlist>
<listitem><para>
	a DOT viewer such as <ulink url="http://www.graphviz.org">graphviz</ulink>
	if you want to be able to view the graphical output generated by &phc (for
	example, syntax trees)
</para></listitem>
</itemizedlist>

<para>
	Under Debian/Ubuntu, the following command will install nearly all
	dependencies: <code>apt-get install build-essential libboost-dev
	libxerces27-dev graphviz libgc-dev</code>. You will still need to install
	the PHP embed SAPI manually.
</para>

</section>

<section id=phpbuild>

<title id=phpbuild.title>PHP <code>embed SAPI</code> installation instructions</title>

<para>
	If you do not intend to compile PHP code using &phc;, you may <link
	linkend=install.instructions>skip</link> this section.
</para>

<para>
	In order to compile code, &phc must have the PHP embed SAPI available, which
	is typically not available via standard package managers. The embed SAPI is
	also required for compiling stand-alone executables.
</para>

<para>
	Download the PHP source (.tar.gz) package from <ulink
	url="http://www.php.net">php.net</ulink>. We will assume you downloaded PHP
	version 5.2.6, the latest version available at time of writing. To extract
	PHP,
</para>

<screen>
tar zxvf php-5.2.6.tar.gz
</screen>

<para>
	This will create a new directory <code>php-5.2.6</code>. In order to configure and compile PHP, you must know what configuration options you require. These are likely to be the same as the version of PHP you are currently using, which can be examined with the command
</para>

<screen>
php -i | grep Configure
</screen>

<para>
	We will assume these options are <code>--enable-bcmath --with-gmp --with-mysql</code>, a configuration which we occasionally use for benchmarking. You are ready to build PHP,
</para>

<screen>
CFLAGS="-O3" ./configure --enable-bcmath --with-gmp --with-mysql --enable-embed
make
</screen>

<para>
	If this command does not succeed, there is a problem with PHP on your
	system, and you should <ulink url="http://bugs.php.net">file a bug report
	with the PHP group</ulink>. (There is a known bug, and long work-around for
	OSX already filed in the PHP bug system).
	<!-- TODO: link -->
</para>

<para>
	The most important part of the command is <code>--enable-embed</code>.
	While the <code>CFLAGS="-O3"</code> environmental variable is optional, we
	find it speeds up the executable by about four times. If PHP is already
	installed on your system, you may want to install this version separately,
	using the <code>--prefix</code> option. Other configuration options are
	discussed in the <link linkend=dev.phpbuild>developer manual</link>.
	Finally, install the embed SAPI:
</para>

<screen>
make install
</screen>

	

</section>
<section id=install.instructions>

<title>Installation Instructions</title>

<para>
	First of all, you must <ulink
	url="http://www.phpcompiler.org/downloads.html">download</ulink> the latest
	release of &phc;. To extract &phc;,
</para>

<screen>
tar zxvf phc-0.2.0.tar.gz
</screen>
	
<para>
	This will create a new directory <code>phc-0.2.0</code> that contains the
	&phc source tree. Finally, you must compile &phc;. If the dependencies are
	in their standard locations, you should be able to simply type
</para>

<screen>
cd phc-0.2.0
./configure
make
</screen>

<para>
	(Consult <code>./configure --help</code> for configuration options, if your
	dependencies are not in standard locations). This should compile without any
	warnings or errors. If this step fails, please send a bug report to the
	<ulink url="http://www.phpcompiler.org/mailinglist.html">mailing
	list</ulink> with as much information about your system as you can give, and
	we will try to resolve it. Finally, install &phc using
</para>

<screen>
make install
</screen>

<para>
	For information on running &phc, see <xref linkend="runningphc"
	endterm="runningphc.title">.  If you can follow those instructions and you
	get the output you should get, congratulations!  You have successfully
	installed &phc;.
</para>	

</section>

</chapter>
